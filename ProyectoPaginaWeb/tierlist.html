<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tierlist</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            line-height: 1.6;
        }

        header {
            background-color: #3E1A47;
            padding: 10px 20px;
            color: white;
            text-align: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: flex-start;
            background-color: #5D3A9B;
            padding: 10px;
            position: fixed;
            width: 200px;
            height: 100%;
        }
        nav ul {
            list-style: none;
            
        }
        nav ul li {
            margin: 15px 0;
        }
        nav ul li a {
            color: #E0E0E0;
            text-decoration: none;
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        nav ul li a:hover {
            background-color: #5D3A9B;
            color: #FFFFFF;
        }

        main {
            margin-left: 220px;
            padding-top: 80px;
            margin-bottom: 100px; /* Para que no se solape con el footer si hay */
        }

        .tierlist-container {
            margin-top: 50px;
            margin-left: 50px;
            width: calc(100% - 50px)-50px;
            padding: 20px;
        }

        .tierlist {
            border: 1px solid #444;
            margin-bottom: 20px;
        }

        .tier-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .tier-label {
            width: 120px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: white;
        }

        .tier-slot {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            flex-grow: 1;
            padding: 10px;
            background-color: #2a2a2e;
            min-height: 70px;
            border-radius: 8px;
        }

        .tier-slot img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            cursor: grab;
            border-radius: 5px;
            transition: box-shadow 0.2s;
        }

        .tier-slot img:hover {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .controls button {
            padding: 10px 15px;
            margin: 0 5px;
            border: none;
            cursor: pointer;
            color: white;
            background-color: #444;
            border-radius: 5px;
        }

        .controls button:hover {
            background-color: #555;
        }

        .edit-btn {
            font-size: 1.2rem;
            background-color: #b57edc;
            color: white;
            border: none;
            cursor: pointer;
        }

        .edit-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
        }

        .edit-modal h2 {
            margin-top: 0;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .images-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
        }

        .images-container img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            cursor: grab;
        }
    </style>
</head>

<body>
    <header>
        <h1>Tierlist Customizable</h1>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="personajes.html">Personajes</a></li>
                <li><a href="tierlist.html">Tier List</a></li>
                <li><a href="guias.html">GuÃ­as</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="tierlist-container">
            <div id="tierlist" class="tierlist">
                <!-- Filas de los tiers -->
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #ff6b6b;">SSS</div>
                    <div class="tier-slot"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #ffa45c;">S</div>
                    <div class="tier-slot"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #ffd56b;">A</div>
                    <div class="tier-slot"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #6bcfff;">B</div>
                    <div class="tier-slot"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #a56bff;">C</div>
                    <div class="tier-slot"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label" style="background-color: #888888;">D</div>
                    <div class="tier-slot"></div>
                </div>
            </div>

            <div class="controls">
                <button id="editTierlist" class="edit-btn">ðŸ–Œ Editar</button>
                <button id="resetTierlist">Resetear</button>
            </div>

        <div id="images" class="images-container">
            <!-- Usa las imÃ¡genes dinÃ¡micamente de personajes.html -->
            <img src="images/seele.png" alt="Character 1" draggable="true">
            <img src="images/bronya.png" alt="Character 2" draggable="true">
            <img src="images/danheng.png" alt="Character 3" draggable="true">
            <img src="images/blade.png" alt="Character 4" draggable="true">
            <img src="images/kafka.png" alt="Character 5" draggable="true">
            <img src="images/welt.png" alt="Character 6" draggable="true">
            <img src="images/bailu.png" alt="Character 7" draggable="true">
            <img src="images/herta.png" alt="Character 8" draggable="true">
            <img src="images/tingyun.png" alt="Character 9" draggable="true">
            <img src="images/loucha.png" alt="Character 10" draggable="true">
            <img src="images/jingyuan.png" alt="Character 11" draggable="true">
            <img src="images/himeko.png" alt="Character 12" draggable="true">
            <img src="images/7marzo.png" alt="Character 13" draggable="true">
            <img src="images/yanqing.png" alt="Character 14" draggable="true">
        </div>
    </div>

     <!-- Modal para editar la lista -->
        <div id="editModal" class="edit-modal">
            <h2>Editar Tierlist</h2>
            <div>
                <label for="tier-name">Nombre del Tier:</label>
                <input type="text" id="tier-name">
            </div>
            <div>
                <label for="tier-color">Color del Tier:</label>
                <input type="color" id="tier-color">
            </div>
            <div class="images-container">
                <img src="images/seele.png" draggable="true">
                <img src="images/bronya.png" draggable="true">
            </div>
        </div>

        <div id="overlay" class="modal-overlay"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tierlist = document.getElementById('tierlist');
            const resetButton = document.getElementById('resetTierlist');
            const editButton = document.getElementById('editTierlist');
            const modal = document.querySelector('.edit-modal');
            const overlay = document.querySelector('.modal-overlay');
            const imagesContainer = document.getElementById('images');
            const originalImages = [...imagesContainer.children];
            const originalTiers = [...tierlist.children].map(tier => ({
                label: tier.querySelector('.tier-label').textContent,
                color: tier.querySelector('.tier-label').style.backgroundColor,
            }));
    
            // Drag-and-drop functionality
            let draggedItem = null;
    
            // Iniciar funcionalidad drag-and-drop para imÃ¡genes y slots
            function initDragAndDrop() {
                document.querySelectorAll('.tier-slot, .images-container').forEach(container => {
                    container.addEventListener('dragover', e => {
                        e.preventDefault();
                        const afterElement = getDragAfterElement(container, e.clientX);
                        const dragging = document.querySelector('.dragging');
                        if (afterElement == null) {
                            container.appendChild(dragging);
                        } else {
                            container.insertBefore(dragging, afterElement);
                        }
                    });
    
                    container.addEventListener('drop', e => {
                        e.preventDefault();
                        if (draggedItem) {
                            container.appendChild(draggedItem);
                            adjustTierHeight(container);
                        }
                    });
                });
    
                // Configurar dragstart y dragend para las imÃ¡genes
                document.querySelectorAll('img').forEach(img => {
                    img.addEventListener('dragstart', () => {
                        draggedItem = img;
                        img.classList.add('dragging');
                        setTimeout(() => (img.style.visibility = 'hidden'), 0); // Ocultar temporalmente
                    });
    
                    img.addEventListener('dragend', () => {
                        img.classList.remove('dragging');
                        img.style.visibility = 'visible'; // Restaurar visibilidad
                        draggedItem = null;
                    });
                });
            }
    
            // Ajustar la altura del tier basado en el contenido
            function adjustTierHeight(container) {
                const tierSlot = container.closest('.tier-slot');
                if (tierSlot) {
                    tierSlot.style.height = `${Math.ceil(tierSlot.children.length / 20) * 80}px`;
                }
            }
    
            // Calcular la posiciÃ³n de inserciÃ³n
            function getDragAfterElement(container, x) {
                const draggableElements = [...container.querySelectorAll('img:not(.dragging)')];
    
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = x - box.left - box.width / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
    
            // Reset tierlist and images
            resetButton.addEventListener('click', () => {
                tierlist.innerHTML = '';
                imagesContainer.innerHTML = '';
                originalTiers.forEach(({ label, color }) => {
                    const row = document.createElement('div');
                    row.className = 'tier-row';
                    row.innerHTML = `
                        <div class="tier-label" style="background-color: ${color}">${label}</div>
                        <div class="tier-slot" draggable="true"></div>
                    `;
                    tierlist.appendChild(row);
                });
                originalImages.forEach(img => imagesContainer.appendChild(img));
                initDragAndDrop(); // Reiniciar drag-and-drop
            });
    
            // Abrir y cerrar el modal de ediciÃ³n
            editButton.addEventListener('click', () => {
                modal.style.display = 'block';
                overlay.style.display = 'block';
                loadEditModal();
            });
    
            overlay.addEventListener('click', closeModal);
    
            function closeModal() {
                modal.style.display = 'none';
                overlay.style.display = 'none';
            }
    
            // Cargar los datos actuales de la tierlist en el modal
            function loadEditModal() {
                modal.innerHTML = `
                    <h2>Editar Tierlist</h2>
                    ${[...tierlist.children].map((tier, index) => `
                        <div class="edit-row">
                            <label>Nombre Tier:</label>
                            <input type="text" class="tier-name" value="${tier.querySelector('.tier-label').textContent}" data-index="${index}">
                            <label>Color:</label>
                            <input type="color" class="tier-color" value="${rgbToHex(tier.querySelector('.tier-label').style.backgroundColor)}" data-index="${index}">
                            <button class="delete-tier" data-index="${index}">Eliminar</button>
                        </div>
                    `).join('')}
                    <button id="addTier">AÃ±adir Tier</button>
                    <button id="saveChanges">Guardar Cambios</button>
                    <button id="cancelEdit">Cancelar</button>
                `;
    
                // Event listeners para acciones del modal
                modal.querySelectorAll('.delete-tier').forEach(button => {
                    button.addEventListener('click', () => {
                        const index = button.dataset.index;
                        tierlist.children[index].remove();
                        loadEditModal();
                    });
                });
    
                modal.querySelector('#addTier').addEventListener('click', () => {
                    const newRow = document.createElement('div');
                    newRow.className = 'tier-row';
                    newRow.innerHTML = `
                        <div class="tier-label" style="background-color: #444">Nuevo Tier</div>
                        <div class="tier-slot" draggable="true"></div>
                    `;
                    tierlist.appendChild(newRow);
                    loadEditModal();
                });
    
                modal.querySelector('#saveChanges').addEventListener('click', () => {
                    modal.querySelectorAll('.edit-row').forEach(row => {
                        const index = row.querySelector('.tier-name').dataset.index;
                        const tier = tierlist.children[index];
                        tier.querySelector('.tier-label').textContent = row.querySelector('.tier-name').value;
                        tier.querySelector('.tier-label').style.backgroundColor = row.querySelector('.tier-color').value;
                    });
                    closeModal();
                });
    
                modal.querySelector('#cancelEdit').addEventListener('click', closeModal);
            }
    
            // Convertir RGB a Hex para el input de color
            function rgbToHex(rgb) {
                const result = rgb.match(/\d+/g).map(Number);
                return `#${result.map(c => c.toString(16).padStart(2, '0')).join('')}`;
            }
    
            initDragAndDrop(); // Inicializar drag-and-drop en el cargado de la pÃ¡gina
        });
    </script>
    

</body>

</html>